<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>振ったら光る＋加速度表示</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: black;
    color: white;
    font-size: 1.5rem;
    transition: background-color 0.3s;
  }
  .lit {
    background-color: yellow;
    color: black;
  }
  .acc-values {
    margin-top: 20px;
    font-family: monospace;
  }
</style>
</head>
<body>
振ってみてください！
<div class="acc-values">
  X: <span id="accX">0</span><br>
  Y: <span id="accY">0</span><br>
  Z: <span id="accZ">0</span>
</div>

<script>
let lastAcc = {x: 0, y: 0, z: 0};
let threshold = 15;
let isLit = false;

const accX = document.getElementById('accX');
const accY = document.getElementById('accY');
const accZ = document.getElementById('accZ');

function updateDisplay(acc) {
    accX.textContent = acc.x.toFixed(2);
    accY.textContent = acc.y.toFixed(2);
    accZ.textContent = acc.z.toFixed(2);
}

// iOS対応
if (typeof DeviceMotionEvent !== 'undefined' &&
    typeof DeviceMotionEvent.requestPermission === 'function') {
    DeviceMotionEvent.requestPermission()
        .then(response => {
            if (response === 'granted') {
                window.addEventListener('devicemotion', handleMotion);
            } else {
                alert('加速度センサーの許可が必要です');
            }
        })
        .catch(console.error);
} else {
    window.addEventListener('devicemotion', handleMotion);
}

function handleMotion(event) {
    const acc = event.accelerationIncludingGravity;

    // 加速度表示更新
    updateDisplay(acc);

    // 振動判定
    const diffX = Math.abs(acc.x - lastAcc.x);
    const diffY = Math.abs(acc.y - lastAcc.y);
    const diffZ = Math.abs(acc.z - lastAcc.z);

    const maxDiff = Math.max(diffX, diffY, diffZ);

    if (maxDiff > threshold) {
        if (!isLit) {
            document.body.classList.add('lit');
            isLit = true;
        }
    } else {
        if (isLit) {
            document.body.classList.remove('lit');
            isLit = false;
        }
    }

    lastAcc = {x: acc.x, y: acc.y, z: acc.z};
}
</script>
</body>
</html>
